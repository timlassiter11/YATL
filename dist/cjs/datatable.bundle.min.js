"use strict";class t{static Events={ROW_CLICK:"dt.row.click",ROWS_CHANGED:"dt.rows.changed",COL_HIDE:"dt.col.hide",COL_SHOW:"dt.col.show",COL_SORT:"dt.col.sort",COL_RESIZE:"dt.col.resize",COL_REARRANGE:"dt.col.rearrange"};#t;#e;#s;#r;#i;#o={};#n=[];#l=[];#a;#h;#d;#c;#u;#m;#f;#g=t=>String(t).toLowerCase().replace(/[^\w\s]/g," ").trim().split(/\s+/);#p=0;#b;#v;#y;#w=null;constructor(s,{formatter:o,columns:n=[],data:l,virtualScroll:a=1e3,highlightSearch:d=!0,resizable:c=!0,rearrangeable:u=!1,extraSearchFields:m,noDataText:f,noMatchText:g,classes:p,tokenizer:b}={}){if("string"==typeof s){if(this.#t=document.querySelector(s),!this.#t)throw new SyntaxError(`Failed to find table using selector ${s}`)}else this.#t=s;if(!(this.#t instanceof HTMLTableElement))throw new TypeError("Invalid table element type. Must be HTMLTableElement");if(!Array.isArray(n))throw new TypeError("columns must be a list of columns");this.#g=b||this.#g,this.#f=d,this.#d=m||[],this.#b=f||"No records found",this.#v=g||"No matching records found",this.#y={...h,...p},this.#c=o,this.#t.classList.add("data-table"),this.#i=document.createElement("div"),this.#i.classList.add(...r(this.#y.scroller)),this.#i.style.overflow="auto",this.#i.style.height="100%",""!==this.#t.style.height&&(this.#i.style.height=this.#t.style.height,this.#t.style.height=""),this.#t.parentElement.insertBefore(this.#i,this.#t),this.#i.append(this.#t),this.#t.querySelectorAll("thead").length>1&&console.warn("Multiple theads found in table. Using last one."),this.#t.querySelectorAll("tbody").length>1&&console.warn("Multiple tbodys found in table. Using first one."),this.#e=this.#t.querySelector("thead:last-of-type"),this.#s=this.#t.querySelector("tbody:first-of-type"),this.#e||(this.#e=document.createElement("thead"),this.#t.insertBefore(this.#e,this.#s)),this.#e.classList.add(...r(this.#y.thead));let v=this.#e.querySelector("tr:last-of-type");v||(v=document.createElement("tr"),this.#e.append(v)),v.classList.add(...r(this.#y.tr)),this.#s||(this.#s=document.createElement("tbody"),this.#t.append(this.#s)),this.#s.classList.add(...r(this.#y.tbody)),this.#s.addEventListener("click",(e=>{let s,r,i;if(e.target instanceof HTMLTableCellElement?(r=e.target,s=r.parentElement,i=r.dataset.dtField):e.target instanceof HTMLTableRowElement&&(s=e.target),s){const e=parseInt(s.dataset.dtIndex);if(!isNaN(e)){const r=this.#l[e],o=new CustomEvent(t.Events.ROW_CLICK,{detail:{row:r,index:e,field:i},bubbles:!0,cancelable:!0});s.dispatchEvent(o)}}}));for(const t of n){let e=this.#e.querySelector(`th[data-dt-field="${t.field}"]`);e?t.title=e.innerText:(e=document.createElement("th"),e.classList.add(...r(this.#y.th)),e.dataset.dtField=t.field,e.innerText=t.title,v.append(e)),t.element=e,t.visible=void 0===t.visible||t.visible,this.#o[t.field]=t}for(const t of this.#e.querySelectorAll("th[data-dt-field]")){const e=t.dataset.dtField;e in this.#o||(this.#o[e]={field:e,title:t.innerText,element:t,sortable:"true"===t.dataset.sortable,searchable:"true"===t.dataset.searchable,visible:"false"!==t.dataset.visible})}let y=!1;for(const t of Object.keys(this.#o)){const e=this.#C(t);e.title||(e.title=i(t));const s=e.element,r=document.createElement("div");r.classList.add("dt-header-name"),r.innerText=e.title,s.innerHTML="",s.append(r),e.visible?y=!0:s.hidden=!0,e.sortable&&(s.classList.add("dt-sortable"),r.addEventListener("click",(()=>{e.sortOrder?"asc"===e.sortOrder?this.sort(t,"desc"):e.sortOrder&&this.sort(t,null):this.sort(t,"asc")})));if(void 0===e.resizable?c:e.resizable){const t=document.createElement("div");t.classList.add("dt-resizer"),t.addEventListener("mousedown",this.#E),t.addEventListener("dblclick",this.#S),s.append(t)}"number"==typeof e.width&&(s.style.width=e.width+"px"),u&&(s.draggable=!0,s.addEventListener("dragstart",this.#L),s.addEventListener("dragenter",this.#T),s.addEventListener("dragover",this.#O),s.addEventListener("dragleave",this.#R),s.addEventListener("drop",this.#x),s.addEventListener("dragend",this.#_))}0===this.#o.length?console.warn("No columns found. At least one column is required."):y||(console.warn("At least a single column must be visible. Showing the first column."),this.showColumn(this.columns[0].field)),this.#u=new e({container:this.#i,element:this.#s,generator:t=>this.#F(t),rows:this.#l}),this.virtualScroll=a,this.loadData(l)}get columns(){return Object.values(this.#o)}get rows(){return this.#l}get length(){return this.#l?this.#l.length:0}get table(){return this.#t}get virtualScroll(){return this.#m===Number.MAX_VALUE||0!==this.#m&&this.#m}set virtualScroll(t){this.#m="number"==typeof t?t:t?0:Number.MAX_VALUE,this.#k()}get virtualScrollStatus(){return this.#u.started}loadData(t){if(Array.isArray(t)&&t.length>0){let e=0;for(const s of t){s[l]=e++;for(const t of this.columns){const e=t.field,r=this.#A(s,e);"function"==typeof t.sortValue?s[`_${e}_sort`]=t.sortValue(r,s):s[`_${e}_sort`]="string"==typeof r?r.toLocaleLowerCase():r,t.searchable&&t.tokenize&&r&&(s[`_${e}_tokens`]=this.#g(r))}}this.#n=t,this.#l=t}else this.#n=[],this.#l=[];this.#H(),this.#z()}showMessage(t,e){Array.isArray(e)?tr.className=e.join(" "):"string"!=typeof e&&(e="");const s=Object.keys(this.#o).length;this.#s.innerHTML=`<tr class="${e}"><td colSpan=${s}>${t}</td></tr>`}search(t){this.#a=""!==t?t:null,this.#z()}filter(t){if("object"!=typeof t&&"function"!=typeof t)throw new TypeError("filters must be object or function");this.#h=t,this.#z()}sort(e,s){const r=this.#C(e);if(!r)return void console.warn(`Attempting to sort non-existent column ${e}`);s!=r.sortOrder&&("asc"===s||"desc"===s?r.sortPriority=this.#p++:(r.sortPriority=null,this.#p--),r.sortOrder=s),this.#H(),this.#M();const i=new CustomEvent(t.Events.COL_SORT,{detail:{column:r,order:r.sortOrder},bubbles:!0,cancelable:!0});this.#t.dispatchEvent(i)}setColumnVisibility(e,s){const r=this.#C(e);if(!r)return void console.warn(`Attempting to ${s?"show":"hide"} non-existent column ${e}`);r.visible=s,this.#t.querySelectorAll(`td[data-dt-field="${e}"], th[data-dt-field="${e}"]`).forEach((t=>t.hidden=!s)),this.#M();const i=s?t.Events.COL_SHOW:t.Events.COL_HIDE,o=new CustomEvent(i,{detail:{column:r,visible:s},bubbles:!0,cancelable:!0});this.#t.dispatchEvent(o)}showColumn(t){this.setColumnVisibility(t,!0)}hideColumn(t){this.setColumnVisibility(t,!1)}export(t,e=!1){const s=e?this.#n:this.#l;if(0===s.length)return;const r=Object.keys(s[0]).filter((t=>t in this.#o&&(!!e||this.#o[t].visible))),i=s.map((t=>{const s=[];for(let[r,i]of Object.entries(t))if(r in this.#o){const o=this.#C(r);(e||o.visible)&&("function"==typeof o.valueFormatter&&(i=o.valueFormatter(i,t)),"string"!=typeof i&&(i=i.toString()),i.replace('"','""'),s.push(`"${i}"`))}return s.join(",")})).join("\n"),o=new Blob([r+"\n"+i],{type:"text/csv;charset=utf-8,"}),n=document.createElement("a");n.style.display="none",n.href=URL.createObjectURL(o),n.download=`${t}.csv`,document.body.append(n),n.click(),n.remove()}scrollTo(t){this.#u.started&&this.#u.scrollTo(t);const e=this.#s.querySelector(`tr[data-dt-index="${t}"]`);if(e){e.scrollIntoView(!0);const t=parseFloat(getComputedStyle(this.#e).height);this.#i.scrollTop-=t}}setColumnOrder(t){if(!Array.isArray(t))throw new TypeError("fields must be an array of field names");Object.values(this.#o);const e=t.map((t=>this.#C(t))).filter((t=>null!==t));this.#o=Object.fromEntries(e.map((t=>[t.field,t]))),this.#H()}refresh(){this.#H(),this.#z()}#$(t,e){return Array.isArray(t)?t.some((t=>this.#$(t,e))):e instanceof RegExp?e.test(String(t)):String(t).toLocaleLowerCase().includes(e)}#D(t,e,s){if(Array.isArray(e)){for(const s of e)if(this.#D(t,s))return!0;return!1}return"function"==typeof s?s(t,e):e instanceof RegExp?e.test(String(t)):e===t}#q(t,e){for(const e of Object.keys(this.#h||{})){const s=this.#h[e],r=this.#C(e),i=r?r.filter:null,o=this.#A(t,e);if(!this.#D(o,s,i))return!1}return!0}#z(){const e="function"==typeof this.#h?this.#h:(t,e)=>this.#q(t,e);let s,r;this.#a instanceof RegExp?(s=this.#a,r=[s]):"string"==typeof this.#a&&(s=this.#a.toLocaleLowerCase(),r=this.#g(s)),this.#l=this.#n.filter(((t,i)=>{if(t._searchScore=0,!e(t,i))return!1;if(!s)return!0;const o=[...this.columns.filter((t=>t.searchable)).map((t=>t.field)),...this.#d];for(const e of o){const i=this.#C(e);if(i&&i.tokenize){const s=t[`_${e}_tokens`]||[];for(const e of r)this.#$(s,e)&&("string"==typeof e?t._searchScore+=e.length:t.searchScore++)}else{const r=this.#A(t,e);this.#$(r,s)&&("string"==typeof s?t._searchScore+=s.length:t._searchScore++)}}return t._searchScore>0})),this.#M(),this.#k(),this.#t.dispatchEvent(new CustomEvent(t.Events.ROWS_CHANGED,{bubbles:!0,cancelable:!0}))}#V(t,e,s){let r,i;if("asc"===s.sortOrder?(r=t[`_${s.field}_sort`],i=e[`_${s.field}_sort`]):"desc"===s.sortOrder&&(r=e[`_${s.field}_sort`],i=t[`_${s.field}_sort`]),"function"==typeof s.sorter){const t=s.sorter(r,i);if(0!==t)return t}return r<i?-1:r>i?1:0}#M(){const t=Object.values(this.#o).filter((t=>t.visible&&"number"==typeof t.sortPriority)).sort(((t,e)=>("number"==typeof t.sortPriority?t.sortPriority:0)-("number"==typeof e.sortPriority?e.sortPriority:0)));this.#l.sort(((e,s)=>{let r=e._searchScore||0,i=s._searchScore||0;if(r>i)return-1;if(r<i)return 1;for(const r of t){const t=this.#V(e,s,r);if(0!==t)return t}return e[l]-s[l]})),this.#k()}#H(){for(const t of Object.keys(this.#o)){const e=this.#C(t);e.element.parentElement.append(e.element),"asc"===e.sortOrder?(e.element.classList.add("dt-ascending"),e.element.classList.remove("dt-descending")):"desc"===e.sortOrder?(e.element.classList.add("dt-descending"),e.element.classList.remove("dt-ascending")):(e.element.classList.remove("dt-ascending"),e.element.classList.remove("dt-descending"))}}#k(){if(this.#s.innerHTML="",this.#l.length){let t=!1;if(this.#l.length>=this.#m)try{this.#u.rowCount=this.#l.length,this.#u.start(),t=!0}catch(t){t instanceof s&&(console.warn("Failed to start virtual scroll... falling back to standard rendering"),console.warn(t.stack))}if(!t){if(!o&&this.#l.length>n){o=!0;const t=n.toLocaleString();console.warn(`Virtual scroll disabled with more than ${t} rows... Good luck with that!`)}this.#u&&this.#u.stop();const t=this.#l.map(((t,e)=>this.#F(e)));this.#s.append(...t)}}else 0===this.#n.length?this.showMessage(this.#b,"dt-empty"):this.showMessage(this.#v,"dt-empty");for(let t=0;t<this.columns.length-1;++t){const e=this.columns[t];""==e.element.style.width&&(e.element.style.width=e.element.offsetWidth+"px")}}#j(t,e,s,r){"function"==typeof s.valueFormatter&&(e=s.valueFormatter(e,r)),t.innerText=null==e?"-":e,"function"==typeof s.elementFormatter&&s.elementFormatter(e,r,t),this.#f&&this.#a&&""!=this.#a&&s.searchable&&(t.innerHTML=t.innerText.replace(new RegExp(this.#a,"i"),(t=>`<mark>${t}</mark>`))),t.hidden=!s.visible}#F(t){const e=this.#l[t],s=document.createElement("tr");s.classList.add(...r(this.#y.tr)),s.dataset.dtIndex=t;for(const t of Object.keys(this.#o)){let i=this.#A(e,t);const o=this.#C(t),n=document.createElement("td");n.classList.add(...r(this.#y.td)),n.dataset.dtField=t,this.#j(n,i,o,e),s.append(n)}return"function"==typeof this.#c&&this.#c(e,s),s}#A(t,e){const s=e.split(".");let r=t;for(const t of s){if(!r||"object"!=typeof r)return;r=r[t]}return r}#C(t){return this.#o[t]}#E=t=>{t.preventDefault(),t.stopPropagation();const e=t.target.closest("th");if(!e)return;const s=e.dataset.dtField,r=this.#C(s);r&&(this.#w=r,r.startX=t.clientX,r.startWidth=e.offsetWidth,document.addEventListener("mousemove",this.#N),document.addEventListener("mouseup",this.#I))};#N=t=>{if(!this.#w)return;t.preventDefault();const e=this.#w.startWidth+(t.clientX-this.#w.startX);this.#w.element.style.width=`${e}px`};#I=e=>{document.removeEventListener("mousemove",this.#N),document.removeEventListener("mouseup",this.#I),this.#t.dispatchEvent(new CustomEvent(t.Events.COL_RESIZE,{detail:{column:this.#w,width:this.#w.element.offsetWidth},bubbles:!0,cancelable:!0})),this.#w=null};#S=t=>{t.target.closest("th").style.width="0px"};#L=t=>{const e=t.target.dataset.dtField;t.dataTransfer.effectAllowed="move",t.dataTransfer.setData("text/plain",e)};#O=t=>(t.preventDefault(),t.dataTransfer.dropEffect="move",!1);#T=t=>{t.target.classList.add("dt-drag-over")};#R=t=>{t.target.classList.remove("dt-drag-over")};#x=e=>{e.preventDefault(),e.stopPropagation();const s=e.dataTransfer.getData("text/plain"),r=e.currentTarget.dataset.dtField,i=Object.values(this.#o),o=i.findIndex((t=>t.field===s)),n=i.findIndex((t=>t.field===r));if(o>-1&&n>-1){const[e]=i.splice(o,1);i.splice(n,0,e),this.#o=Object.fromEntries(i.map((t=>[t.field,t])));const s=i[i.length-1];s&&(s.element.style.width=""),this.#H(),this.#k(),this.#t.dispatchEvent(new CustomEvent(t.Events.COL_REARRANGE,{detail:{draggedColumn:e,dropColumn:this.#C(r),columns:i},bubbles:!0,cancelable:!0}))}};#_=t=>{document.querySelectorAll(".dt-drag-over").forEach((t=>{t.classList.remove("dt-drag-over")}))}}class e{#P;#W;#K;#U=0;#G=0;#X=2;#Z;#B=!1;#J=0;constructor({container:t,element:e,generator:s,nodePadding:r=2}){this.#P=t,this.#W=e,this.#K=s,this.#X=r}get rowCount(){return this.#U}set rowCount(t){this.#U=t,this.#Q()}get rowHeight(){return this.#G||this.#Y(),this.#G}get started(){return this.#B}scrollTo(t){this.#P.scrollTop=this.rowHeight*t,this.#Q()}#tt=()=>{this.#P.scrollTop!==this.#J&&(this.#J=this.#P.scrollTop,this.#Z&&cancelAnimationFrame(this.#Z),this.#Z=requestAnimationFrame((()=>this.#Q())))};#et=()=>{this.#Q()};start(){this.#B||(this.#B=!0,this.#P.addEventListener("scroll",this.#tt),window.addEventListener("resize",this.#et),this.#Q())}stop(){this.#Z&&cancelAnimationFrame(this.#Z),this.#P.removeEventListener("scroll",this.#tt),window.removeEventListener("resize",this.#et),this.#B=!1}#Q(){const t=this.#P.scrollTop,e=this.rowCount,s=this.rowHeight,r=this.#X,i=s*e;this.#W.innerHTML=`<tr style="height: ${i}px;"></tr>`;const n=this.#W.offsetHeight,l=this.#P.offsetHeight;if(!o&&n<i.toFixed(0)-1&&(o=!0,console.error("Max element height exceeded. Virtual scroll may not work.")),!e||!s)return;let a=Math.floor(t/s)-r;a=Math.max(0,a);let h=Math.ceil(l/s)+2*r;h=Math.min(e-a,h);const d=a*s,c=i-(d+h*s);try{this.#W.innerHTML="";const t=new Array(h).fill(null).map(((t,e)=>this.#K(e+a)));let e=document.createElement("tr"),s=document.createElement("tr");e.style.height=d+"px",s.style.height=c+"px",this.#W.append(e),this.#W.append(...t),this.#W.append(s)}catch(t){t instanceof RangeError&&console.log(t)}}#Y(){if(0===this.#U)return void(this.#G=0);const t=Math.min(1e3,this.#U),e=[];for(let s=0;s<t;++s)e.push(this.#K(s));if(this.#W.innerHTML="",this.#W.append(...e),this.#G=this.#W.offsetHeight/t,this.#G<=0)throw new s("First 1000 rows had no rendered height. Virtual scroll can't be used.");this.#G*this.#U>a&&console.warn("Virtual scroll height exceeded maximum known element height.")}}class s extends Error{constructor(t){super(t)}}const r=t=>{if("string"==typeof t)return t.split(" ");if(Array.isArray(t))return t;if(null==t)return[];throw new TypeError("classes must be string or array of strings")},i=t=>t.replace(/_/g," ").replace(/([a-z])([A-Z])/g,"$1 $2").replace(/\b\w/g,(t=>t.toUpperCase()));let o=!1;const n=1e4,l="_dt_index",a=33554400,h={scroller:"dt-scroller",thead:"dt-headers"};exports.DataTable=t,exports.LocalStorageAdapter=class{#st;#rt;#it={saveColumnSorting:!0,saveColumnVisibility:!0,saveColumnWidth:!0,saveColumnOrder:!0};constructor(e,s,r={}){this.#st=e,this.#rt=s,this.#it={...this.#it,...r},this.restoreState();const i=e.table;this.#it.saveColumnSorting&&i.addEventListener(t.Events.COL_SORT,(()=>this.saveState())),this.#it.saveColumnVisibility&&(i.addEventListener(t.Events.COL_HIDE,(()=>this.saveState())),i.addEventListener(t.Events.COL_SHOW,(()=>this.saveState()))),this.#it.saveColumnWidth&&i.addEventListener(t.Events.COL_RESIZE,(()=>this.saveState())),this.#it.saveColumnOrder&&i.addEventListener(t.Events.COL_REARRANGE,(()=>this.saveState()))}saveState(){const t=this.#st.columns.map((t=>({field:t.field,sortOrder:t.sortOrder,sortPriority:t.sortPriority,visible:t.visible,width:t.element.style.width})));localStorage.setItem(this.#rt,JSON.stringify(t))}restoreState(){const t=localStorage.getItem(this.#rt);if(t)try{const e=JSON.parse(t),s=this.#st.columns;e.forEach((t=>{const e=s.find((e=>e.field===t.field));e&&(this.#it.saveColumnSorting&&(e.sortOrder=t.sortOrder,e.sortPriority=t.sortPriority),this.#it.saveColumnVisibility&&this.#st.setColumnVisibility(e.field,t.visible),this.#it.saveColumnWidth&&(e.element.style.width=t.width))})),this.#it.saveColumnOrder&&this.#st.setColumnOrder(e.map((t=>t.field))),this.#st.refresh()}catch(t){console.error("Failed to restore DataTable state:",t)}}clearState(){localStorage.removeItem(this.#rt)}};
//# sourceMappingURL=datatable.bundle.min.js.map
