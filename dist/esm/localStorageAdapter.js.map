{"version":3,"file":"localStorageAdapter.js","sources":["../../src/plugins/localStorageAdapter.js"],"sourcesContent":["import { DataTable } from \"../datatable.js\";\r\n\r\n/**\r\n * @typedef {object} Options\r\n * @property {string} saveColumnSorting - Whether to save sorting state. Default is true.\r\n * @property {string} saveColumnOrder - Whether to save column order. Default is true.\r\n * @property {string} saveColumnVisibility - Whether to save column visibility. Default is true.\r\n * @property {string} saveColumnWidth - Whether to save column width. Default is true.\r\n */\r\n\r\nexport class LocalStorageAdapter {\r\n    /** @type {DataTable} */\r\n    #dataTable;\r\n    /** @type {string} */\r\n    #storageKey;\r\n    /** @type {Options} */\r\n    #options = {\r\n        saveColumnSorting: true,\r\n        saveColumnVisibility: true,        \r\n        saveColumnWidth: true,\r\n        saveColumnOrder: true,\r\n    }\r\n\r\n    /**\r\n     * @param {DataTable} dataTable - The DataTable instance to monitor.\r\n     * @param {string} storageKey - The key to use for saving the state in localStorage.\r\n     * @param {Options} options - The key to use for saving the state in localStorage.\r\n     */\r\n    constructor(dataTable, storageKey, options = {}) {\r\n        this.#dataTable = dataTable;\r\n        this.#storageKey = storageKey;\r\n        this.#options = { ...this.#options, ...options };\r\n\r\n        // Restore state before adding the listeners.\r\n        this.restoreState();\r\n\r\n        const table = dataTable.table;\r\n\r\n        if (this.#options.saveColumnSorting) {\r\n            table.addEventListener(DataTable.Events.COL_SORT, () => this.saveState());\r\n        }\r\n\r\n        if (this.#options.saveColumnVisibility) {\r\n            table.addEventListener(DataTable.Events.COL_HIDE, () => this.saveState());\r\n            table.addEventListener(DataTable.Events.COL_SHOW, () => this.saveState());\r\n        }\r\n\r\n        if (this.#options.saveColumnWidth) {\r\n            table.addEventListener(DataTable.Events.COL_RESIZE, () => this.saveState());\r\n        }\r\n\r\n        if (this.#options.saveColumnOrder) {\r\n            table.addEventListener(DataTable.Events.COL_REARRANGE, () => this.saveState());\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Saves the current column state to localStorage.\r\n     */\r\n    saveState() {\r\n        const columnStates = this.#dataTable.columns.map((col) => ({\r\n            field: col.field,\r\n            sortOrder: col.sortOrder,\r\n            sortPriority: col.sortPriority,\r\n            visible: col.visible,\r\n            width: col.element.style.width,\r\n        }));\r\n\r\n        localStorage.setItem(this.#storageKey, JSON.stringify(columnStates));\r\n    }\r\n\r\n    /**\r\n     * Restores the column state from localStorage.\r\n     */\r\n    restoreState() {\r\n        const savedState = localStorage.getItem(this.#storageKey);\r\n        if (!savedState) return;\r\n\r\n        try {\r\n            const columnStates = JSON.parse(savedState);\r\n            const columns = this.#dataTable.columns;\r\n\r\n            columnStates.forEach((savedCol) => {\r\n                const col = columns.find((c) => c.field === savedCol.field);\r\n                if (col) {\r\n                    \r\n                    if (this.#options.saveColumnSorting) {\r\n                        col.sortOrder = savedCol.sortOrder;\r\n                        col.sortPriority = savedCol.sortPriority;\r\n                    }\r\n\r\n                    if (this.#options.saveColumnVisibility) {\r\n                        this.#dataTable.setColumnVisibility(col.field, savedCol.visible);\r\n                    }\r\n\r\n                    if (this.#options.saveColumnWidth) {\r\n                        col.element.style.width = savedCol.width;\r\n                    }\r\n                }\r\n            });\r\n\r\n            if (this.#options.saveColumnOrder) {\r\n                this.#dataTable.setColumnOrder(columnStates.map((col) => col.field));\r\n            }\r\n\r\n            this.#dataTable.refresh();\r\n\r\n        } catch (error) {\r\n            console.error(\"Failed to restore DataTable state:\", error);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Clears the saved state from localStorage.\r\n     */\r\n    clearState() {\r\n        localStorage.removeItem(this.#storageKey);\r\n    }\r\n}"],"names":[],"mappings":"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"}